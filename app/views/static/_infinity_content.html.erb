<p>So, how is it done?</p>
<p>There are several ways of achieving a parallax effect, but the technique we are using here is to overlay <em>div</em> elements on the page and position their background images at fixed coordinates. This allows the backgrounds to fall outside of the flow of the document.</p>
<p>Upon scrolling the document, we calculate new positions for the background images and move them accordingly. Items that are "closer" to the viewpoint should move faster than those that are further away.</p>
<p>For example, the planet Earth is much closer to the viewpoint (let's assume we are the Sun) than the planet Neptune. In this demonstration, Earth will move at exactly <em>0.268</em> times the speed of the scolling window, whereas Neptune (because it is much further away) will travel at <em>0.008</em> times the speed. This value is the object's <em>inertia</em>, so the closer objects have greater inertia.</p>
<p>So, if we scroll vertically down for <em>19  pixels</em>, Earth will move upwards <em>5.09 pixels</em> and Neptune will move only <em>0.15 pixels</em>. The offsets are the same, but negated, if we scroll upwards. As should be obvious, Neptune will stay in the document view for much longer than the Earth.</p>
<p>The formula for calculating a new position is simple:</p>
<p><b>-((h + p) - (h + a)) * i)</b></p>
<p>Where <b>h</b> is the document height, <b>p</b> is the current offset, <b>a</b> is the adjuster value and <b>i</b> is the inertia.</p>
<p>The two potentially confusing variables here are the adjuster value (<b>a</b>) and the inertia (<b>i</b>).</p>
<p>The adjuster value is unique to each object. It's effectively the offset that will be apparent when the object will hit the top of the page. If all browsers jumped at the same intervals during scroll then we could calculate this value, but I recommend you just tinker with it until you get it right. I store it as an HTML5 data attribute on the <em>div</em> element itself.</p>
<p>The inertia should be something between 1 (moves at same speed as scroll) and 0 (is totally stationary). In this example, I divide a number representing the planets distance from the Sun with a hard-coded threshold of 40,000,000 (a number slightly less than the distance in kilometers between the Sun and Mercury).</p>
